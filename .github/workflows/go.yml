# 此工作流将构建一个 Go 语言项目
# 更多信息请参阅：https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-go

# 工作流名称
# name 定义工作流的显示名称
# 这个名称会在 GitHub Actions 界面中显示
name: Go

# 定义触发工作流的事件
# on 指定哪些事件会触发此工作流的执行
on:
  # push 事件：当代码推送到仓库时触发
  push:
    # branches 指定哪些分支的推送会触发工作流
    # ["master"] 表示只有推送到 master 分支时才会触发
    branches: [ "master" ]
  
  # pull_request 事件：当创建或更新拉取请求时触发
  pull_request:
    # branches 指定哪些分支的拉取请求会触发工作流
    # ["master"] 表示只有针对 master 分支的拉取请求才会触发
    branches: [ "master" ]

# 定义工作流中的作业
# jobs 是一个或多个作业的集合
# 每个作业在一个独立的运行器中执行
jobs:

  # 定义构建作业
  # build 是作业的名称
  build:
    # runs-on 指定作业运行的环境
    # ubuntu-latest 表示使用最新版本的 Ubuntu Linux
    # GitHub Actions 提供了多个运行器环境：ubuntu-latest、windows-latest、macos-latest 等
    runs-on: ubuntu-latest
    
    # 定义作业中的步骤
    # steps 是一个或多个步骤的集合
    # 每个步骤按顺序执行
    steps:
    
    # 步骤 1：检出代码
    # uses 指定要使用的 GitHub Action
    # actions/checkout@v4 是官方提供的检出代码 Action
    # @v4 表示使用 v4 版本
    # 这个步骤会将仓库代码克隆到运行器中
    - uses: actions/checkout@v4

    # 步骤 2：设置 Go 环境
    # name 定义步骤的显示名称
    - name: Set up Go
      # uses 指定要使用的 GitHub Action
      # actions/setup-go@v4 是官方提供的设置 Go 环境的 Action
      # @v4 表示使用 v4 版本
      uses: actions/setup-go@v4
      # with 定义传递给 Action 的参数
      with:
        # go-version 指定要安装的 Go 版本
        # '1.20' 表示安装 Go 1.20 版本
        # 也可以使用 '1.x' 来使用最新的 1.x 版本
        go-version: '1.20'

    # 步骤 3：构建项目
    # name 定义步骤的显示名称
    - name: Build
      # run 定义要在运行器中执行的命令
      # go build 是 Go 的编译命令
      # -v 表示显示详细输出信息
      # ./... 表示编译当前目录及其所有子目录中的包
      run: go build -v ./...

    # 步骤 4：运行测试
    # name 定义步骤的显示名称
    - name: Test
      # run 定义要在运行器中执行的命令
      # go test 是 Go 的测试命令
      # -v 表示显示详细输出信息
      # ./... 表示测试当前目录及其所有子目录中的测试
      run: go test -v ./...
